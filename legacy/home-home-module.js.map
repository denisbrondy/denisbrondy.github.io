{"version":3,"sources":["webpack:///./src/app/home/home.module.ts","webpack:///./src/app/home/home.page.html","webpack:///./src/app/home/home.page.scss","webpack:///./src/app/home/home.page.ts"],"names":[],"mappings":"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","file":"home-home-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { IonicModule } from '@ionic/angular';\nimport { RouterModule } from '@angular/router';\n\nimport { HomePage } from './home.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild([\n      {\n        path: '',\n        component: HomePage\n      }\n    ])\n  ],\n  declarations: [HomePage]\n})\nexport class HomePageModule {}\n","module.exports = \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button></ion-menu-button>\\n    </ion-buttons>\\n    <ion-title>\\n      Bluetooth stepper controller\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content padding>\\n  <ion-button size=\\\"full\\\" (click)=\\\"scan()\\\" [disabled]=\\\"isScanButtonDisabled\\\">Scan and connect</ion-button>\\n  <ion-list>\\n    <ion-item>\\n      <ion-label color=\\\"primary\\\">Device</ion-label>\\n      <ion-input placeholder=\\\"Perform scan first\\\" [readonly]=\\\"true\\\" [(ngModel)]=\\\"deviceName\\\"></ion-input>\\n    </ion-item>\\n    <ion-item>\\n      <ion-label color=\\\"primary\\\">Status</ion-label>\\n      <ion-input placeholder=\\\"Unknown\\\" [readonly]=\\\"true\\\" [(ngModel)]=\\\"deviceStatus\\\"></ion-input>\\n    </ion-item>\\n  </ion-list>\\n  <ion-button size=\\\"full\\\" (click)=\\\"disconnect()\\\" [disabled]=\\\"isDisconnectButtonDisabled\\\">Disconnect</ion-button>\\n  <h1>Motor control</h1>\\n  <ion-list>\\n    <ion-item>\\n      <ion-label color=\\\"primary\\\">Motor step position</ion-label>\\n      <ion-input placeholder=\\\"Unknown\\\" [readonly]=\\\"true\\\" [(ngModel)]=\\\"motorStepPosition\\\"></ion-input>\\n    </ion-item>\\n    <ion-item>\\n      <ion-label color=\\\"primary\\\">Motor course step position</ion-label>\\n      <ion-input placeholder=\\\"Unknown\\\" [readonly]=\\\"true\\\" [(ngModel)]=\\\"motorCourseStepPosition\\\"></ion-input>\\n    </ion-item>\\n    <ion-item>\\n      <ion-label>Step mode</ion-label>\\n      <ion-select value=\\\"1\\\" okText=\\\"Ok\\\" cancelText=\\\"Cancel\\\" [(ngModel)]=\\\"stepFactor\\\" [disabled]=\\\"areControlsDisabled\\\">\\n        <ion-select-option value=\\\"1\\\">Step by step</ion-select-option>\\n        <ion-select-option value=\\\"10\\\">10 steps</ion-select-option>\\n        <ion-select-option value=\\\"360\\\">Revolution per revolution</ion-select-option>\\n        <ion-select-option value=\\\"3600\\\">10 revolutions</ion-select-option>\\n      </ion-select>\\n    </ion-item>\\n    <ion-button size=\\\"full\\\" (click)=\\\"stepForward()\\\" [disabled]=\\\"areControlsDisabled\\\">\\n      <ion-icon name=\\\"arrow-dropup-circle\\\"></ion-icon>Forward</ion-button>\\n    <ion-button size=\\\"full\\\" (click)=\\\"stepBackward()\\\" [disabled]=\\\"areControlsDisabled\\\">\\n      <ion-icon name=\\\"arrow-dropdown-circle\\\"></ion-icon>Backward</ion-button>\\n    <ion-button size=\\\"full\\\" (click)=\\\"resetStep()\\\" [disabled]=\\\"areControlsDisabled\\\">Set zero position</ion-button>\\n    <ion-button size=\\\"full\\\" (click)=\\\"setCourseStep()\\\" [disabled]=\\\"areControlsDisabled\\\">Set course position</ion-button>\\n    <ion-button size=\\\"full\\\" color=\\\"warning\\\" (click)=\\\"makecourse()\\\" [disabled]=\\\"areControlsDisabled\\\">MAKE COURSE</ion-button>\\n    <ion-button size=\\\"full\\\" color=\\\"danger\\\" (click)=\\\"stopMotor()\\\" [disabled]=\\\"areControlsDisabled\\\">STOP</ion-button>\\n  </ion-list>\\n</ion-content>\"","module.exports = \"\"","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: 'home.page.html',\n  styleUrls: ['home.page.scss'],\n})\nexport class HomePage {\n\n  public isScanButtonDisabled: boolean = false;\n\n  public isDisconnectButtonDisabled: boolean = true;\n\n  public areControlsDisabled: boolean = true;\n\n  public bleDevice: BluetoothDevice = null;\n\n  public bleServer: BluetoothRemoteGATTServer = null;\n\n  public bleService: BluetoothRemoteGATTService = null;\n\n  public commandCharacteristic: BluetoothRemoteGATTCharacteristic = null;\n\n  public deviceName: String = '';\n\n  public deviceStatus: String = '';\n\n  public motorStepPosition: number;\n\n  public motorCourseStepPosition: number;\n\n  public data: String = '';\n\n  public stepFactor: number = 1;\n\n  private handleError(error) {\n    console.log(error);\n  }\n\n  public stringToArrayBuffer(str: String) {\n    // assuming 8 bit bytes\n    var ret = new Uint8Array(str.length);\n    for (var i = 0; i < str.length; i++) {\n      ret[i] = str.charCodeAt(i);\n    }\n    return ret.buffer;\n  }\n\n  public makecourse() {\n    var buffer = new ArrayBuffer(1);\n    var dataView = new DataView(buffer);\n    dataView.setInt8(0, 6);\n    this.commandCharacteristic.writeValue(dataView);\n  }\n\n  public stepForward() {\n    var buffer = new ArrayBuffer(3);\n    var dataView = new DataView(buffer);\n    dataView.setInt8(0, 1);\n    dataView.setInt16(1, this.stepFactor);\n    this.commandCharacteristic.writeValue(dataView);\n  }\n\n  public stepBackward() {\n    var buffer = new ArrayBuffer(3);\n    var dataView = new DataView(buffer);\n    dataView.setInt8(0, 2);\n    dataView.setInt16(1, this.stepFactor);\n    console.log(dataView);\n    this.commandCharacteristic.writeValue(dataView);\n  }\n\n  public resetStep() {\n    var buffer = new ArrayBuffer(1);\n    var dataView = new DataView(buffer);\n    dataView.setInt8(0, 3);\n    this.commandCharacteristic.writeValue(dataView);\n  }\n\n  public setCourseStep() {\n    var buffer = new ArrayBuffer(1);\n    var dataView = new DataView(buffer);\n    dataView.setInt8(0, 4);\n    this.commandCharacteristic.writeValue(dataView);\n  }\n\n  public stopMotor() {\n    var buffer = new ArrayBuffer(1);\n    var dataView = new DataView(buffer);\n    dataView.setInt8(0, 5);\n    this.commandCharacteristic.writeValue(dataView);\n  }\n\n  public setConnected() {\n    this.deviceStatus = 'Connected';\n    this.isDisconnectButtonDisabled = false;\n    this.areControlsDisabled = false;\n  }\n\n  private receiveService(service: BluetoothRemoteGATTService) {\n    this.setConnected();\n    this.bleService = service;\n    var that = this;\n\n    this.bleService.getCharacteristic('38149ecc-adb2-4ff3-89d5-6083d52c5e9f').then(function (characteristic: BluetoothRemoteGATTCharacteristic) {\n      return characteristic.startNotifications();\n    })\n      .then(function (characteristic) {\n        characteristic.addEventListener('characteristicvaluechanged',\n          function (event) {\n            let charac: BluetoothRemoteGATTCharacteristic = <BluetoothRemoteGATTCharacteristic>event.target;\n            that.motorStepPosition = charac.value.getInt32(0, true);\n            that.motorCourseStepPosition = charac.value.getInt32(4, true);\n          });\n      }).catch(function (error) {\n        that.handleError(error);\n      });\n\n    this.bleService.getCharacteristic('8a21ad2c-279d-41d1-94bf-6916ecbb3695').then(function (characteristic: BluetoothRemoteGATTCharacteristic) {\n      that.commandCharacteristic = characteristic;\n    }).catch(function (error) {\n      that.handleError(error);\n    });\n  }\n\n  private connect() {\n    this.deviceStatus = 'Connecting...';\n    var that = this;\n    this.bleServer.getPrimaryService('39ead0db-0bbf-449a-9af9-24001ea09aa3').then(function (service: BluetoothRemoteGATTService) {\n      that.receiveService(service);\n    }).catch(function (error) {\n      that.handleError(error);\n    });\n  }\n\n  public setDisconnected(event) {\n    this.deviceStatus = 'Disconnected';\n    this.isDisconnectButtonDisabled = true;\n    this.areControlsDisabled = true;\n  }\n\n  public disconnect() {\n    this.deviceStatus = 'Disconnecting...';\n    if (this.bleDevice.gatt.connected) {\n      this.bleDevice.gatt.disconnect();\n      this.setDisconnected(this);\n    }\n  }\n\n  private receiveServer(server: BluetoothRemoteGATTServer) {\n    this.bleServer = server;\n    this.connect();\n  }\n\n  private receiveDevice(device: BluetoothDevice) {\n    this.bleDevice = device;\n    this.deviceName = this.bleDevice.name;\n    this.isScanButtonDisabled = false;\n    var that = this;\n    this.bleDevice.addEventListener('gattserverdisconnected', that.setDisconnected);\n    this.bleDevice.gatt.connect().then(function (server: BluetoothRemoteGATTServer) {\n      that.receiveServer(server);\n    }).catch(function (error) {\n      that.handleError(error);\n    });\n  }\n\n  public scan() {\n    if (this.isScanButtonDisabled == false) {\n      this.isScanButtonDisabled = true;\n      var that = this;\n      (window.navigator as any).bluetooth.requestDevice({\n        acceptAllDevices: true,\n        optionalServices: ['39ead0db-0bbf-449a-9af9-24001ea09aa3']\n      }).then(function (device: BluetoothDevice) {\n        that.receiveDevice(device);\n      }).catch(function (error) {\n        that.handleError(error);\n      });\n    }\n  }\n\n}\n"],"sourceRoot":""}